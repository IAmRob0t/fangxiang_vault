---
tags:
  - C
---
常用的位运算符如下表所示：

| 序号  | 运算符 | 含义   |
| --- | --- | ---- |
| 1   | &   | 按位与  |
| 2   | \|  | 按位取  |
| 3   | ~   | 按位取反 |
| 7   | <<  | 左移   |
| 8   | >>  | 右移   |

# 逻辑移位

> [!tip] Tips
> 在嵌入式开发中，我们只涉及逻辑移位：不关心符号位，都是补 0。


在 C 语言里，逻辑移位、算术移位都是使用 `<<` 和 `>>` ，无法区分。一般来说，无符号类型的数值移位时是“逻辑移位”，“有符号”的数值移位时是“算术移位”。

## 1. 逻辑左移

```c
unsigned int a = 0x123;// a = 0b 0001 0010 0011
unsigned int b = a<<2; // b = 0b 0100 1000 1100 = 0x48C
```

逻辑左移两位就是在二进制数位后添加两个 0 ，前面多余的位删除

`0x48c = 0x123 * 2^2 = 0x123 * 4`


## 2. 逻辑右移

```c
unsigned int a = 0x123;// a = 0b 0001 0010 0011
unsigned int b = a>>2; // b = 0b 0000 0100 1000 = 0x48
```

逻辑右移两位就相当于在二进制数位前添加两个 0

`0x48 = 0x123 / 2^2 = 0x123 / 4`

> [!NOTE] 每次左移，相当与乘以 2；每次右移，相当于除以 2。

# 取反

```c
unsigned int a = 0x123;
unsigned int b = ~a; // b的每一位，都是a对应位的取反
```

# 位与

```c
unsigned int a = 0x123;
unsigned int b = 0x456;
unsigned int c = a & b; // c等于a位与b，即：a,b的每一位进行与操作
```

两位相与，结果如下：

```
1 & 1 = 1
1 & 0 = 0
0 & 1 = 0
0 & 0 = 0
```

# 位或

```c
unsigned int a = 0x123;
unsigned int b = 0x456;
unsigned int c = a | b; // c等于a位或b，即：a,b的每一位进行或操作
```

两位相或，结果如下：

```
1 | 1 = 1
1 | 0 = 1
0 | 1 = 1
0 | 0 = 0
```
 
# 置位

```c
unsigned int a = 0x123;
unsigned int b = a | (1<<7) | (1<<8); // 设置a的bit7, bit8, 赋给b
```

`(1<<7) | (1<<8)` 就是位掩码

> [!NOTE] 位掩码
> 是一种利用二进制数的各个位来表示特定状态或选项的技术，通过位运算（如与、或、异或）快速操作或检查这些状态，常用于高效管理多个布尔标志或权限控制，节省内存且提升运算效率。

# 清位

```c
unsigned int a = 0x123;
unsigned int b = a & ~((1<<7) | (1<<8)); // 清除a的bit7, bit8, 赋给b
```

# 把某几位设置为某值

比如要把 bit 7 设置为 1，把 bit 8 清除为 0，这可以分两步操作：先设置 bit 7，再清除 bit 8。还有一种情况：`bit[8:7]= val`, 不知道 `val` 的取值是多少，怎么办？先清除 bit 8、bit 7，再或上 val，代码如下：

```c
unsigned int a = 0x123;
unsigned int b = a & ~(3<<7); /* 清除bit7, bit8 */
b = b | (val << 7); /* 设置bit7, bit8为val */
```