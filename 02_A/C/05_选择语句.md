---
tags:
  - c
---
- 选择语句（selection statement）。`if` 语句和 `switch` 语句允许程序在一组可选项中选择一条特定的执行路径。
- 重复语句（iteration statement）。`while` 语句、`do` 语句和 `for` 语句支持重复（循环） 操作。
- 跳转语句（jump statement）。`break` 语句、`continue` 语句和 `goto` 语句导致无条件地跳转到程序中的某个位置。（`return` 语句也属于此类。）

C 语言还有其他两类语句，一类是复合语句（把几条语句组合成一条语句），一类是空语句 （不执行任何操作）。

# 逻辑表达式

## 关系运算符

## 判等运算符

## 逻辑运算符

运算符 `&&`  和运算符 `||` 都对操作数进行 “短路”计算。也就是说，这些运算符首先计算出左操作数的值，然后计算右操作数。如果表达式的值可以仅由左操作数的值推导出来，那么将不计算右操作数的值。

> [!warning] 
> 要注意逻辑表达式的副作用。有了运算符 `&&` 和运算符 `||` 的短路特性，操作数的副作用并不一定会发生。思考下面的表达式：
> ```c
> i > 0 && ++j > 0
> ```
> 虽然 `j` 因为表达式计算的副作用进行了自增操作，但并不总是这样。如果 `i > 0` 的结果为假，将不会计算表达式`++j > 0`，那么 `j` 也就不会进行自增。把表达式的条件变成`++j > 0 && i > 0`，就可以解决这种短路问题。或者更好的办法是单独对 `j` 进行自增操作。

# `if` 语句

## 复合语句

复合语句由一对花括号，以及花括号内的声明和语句混合而成。可以有多个声明和多条语句，也可以都没有。在后一种情况下，复合语句只有一对花括号，它什么也不做。

## `else` 子句

## 级联式 `if` 语句

## "悬空 `else`" 的问题

## 条件表达式

**条件运算符（conditional operator）** 由符号 `?` 和符号 `:` 组成，两个符号必须按如下格式一起使用：

```c
表达式1 ? 表达式2 : 表达式3
```

条件运算符是 C 运算符中唯一一个要求 3 个操作数的运算符。因此，它通常被称为**三元（ternary）运算符**。

## C89 中的布尔值

C89 的程序员通常使用 TRUE 和 FALSE 这样的名字定义宏：

```c
#define TRUE	1
#define FALSE	0
```

为了判定 flag 是否为真，可以用

```c
if (flag == TRUE) ...
```

或者只写

```c
if (flag) ...
```

后一种形式更好，一是它更简洁，二是当 flag 的值不是 0 或 1 时程序也能正确运行。

为了判定 flag 是否为假，可以用

```c
if (flag == FALSE) ...
```

或者

```c
if (!flag) ...
```

为了发扬这一思想，甚至可以定义一个可用作类型的宏：

```c
#define BOOL	int
```

声明布尔变量时可以用 `BOOL` 代替 `int`：

```c
BOOL flag;
```

在后面的章节中，我们将介绍一些更好的方法，可以使用类型定义（ 7.5 节）和枚举（ 16.5 节）在 C89 中设置布尔类型。

## C99 中的布尔值

C99 提供了 `_Bool` 型

`_Bool` 是整数类型（更准确地说是无符号整型），因此 `_Bool` 变量实际上就是整型变量；但是和一般的整型不同，`_Bool` 只能赋值为 0 或 1。一般来说，往 `_Bool` 变量中存储非零值会导致变量赋值为 1

除了 `_Bool` 类型的定义，C99 还提供了一个新的头 `<stdbool.h>`，这使得操作布尔值更加容易。该头提供了 `bool` 宏，用来代表 `_Bool`。`<stdbool.h>` 头还提供了 `true` 和 `false` 两个宏，分别代表 1 和 0。

# `switch` 语句

`switch` 语句往往比级联式 `if` 语句更容易阅读。此外，`switch` 语句往往比 `if` 语句执行速度快，特别是在有许多情况要判定的时候。

`switch` 语句最常用的格式如下：

```c
switch (表达式) {
	case 常量表达式 : 语句
	...
	case 常量表达式 : 语句
	default : 语句
}
```

- 控制表达式。`switch` 后边必须跟着由圆括号括起来的整型表达式。C 语言把字符（ 7.3 节）当成整数来处理，因此在 `switch` 语句中可以对字符进行判定。但是，**这不适用于浮点数和字符串**。
- 分支标号。每个分支的开头都有一个标号，格式如下：`case 常量表达式 ：`
  **常量表达式（constant expression）** 很像普通的表达式，只是不能包含变量和函数调用。因此，5 是常量表达式，5 + 10 也是常量表达式，但 n + 10 不是常量表达式（除非 n 是表示常量的宏）。分支标号中常量表达式的值必须是整数（字符也可以）。
- 语句。每个分支标号的后边可以跟任意数量的语句，并且不需要用花括号把这些语句括起来。（好好享受这一点，这可是 C 语言中少数几个不需要花括号的地方。）每组语句的最后一条通常是 break 语句。

C 语言不允许有重复的分支标号，但对分支的顺序没有要求，特别是 `default` 分支不一定要放置在最后。

`case` 后边只可以跟随一个常量表达式。但是，多个分支标号可以放置在同一组语句的前面：

```c
switch (grade) {
	case 4:
	case 3:
	case 2:
	case 1:		printf("Passing");
				break;
	case 0:		printd("Failing");
				break;
	default:	printf("Illegal grade");
				break;
}
```

为了节省空间，程序员有时还会把几个分支标号放置在同一行中：

```c
switch (grade) {
	case 4: case 3: case 2: case l:
			printf("Passing");
			break;
	case 0:  printf("Failing");
			break;
	default: printf("Illegal grade");
			break;
}
```

`switch` 语句不要求一定有 `default` 分支。

## `break` 语句的作用

故意从一个分支跳转到下一个分支的情况是非常少见的，因此明确指出故意省略 `break` 语句的情况是一个好主意

虽然 `switch` 语句中的最后一个分支不需要 `break` 语句，但通常还是会放一个 `break` 语句在那里，以防止将来增加分支数目时出现“丢失 `break`”的问题。

# 问与答

> [!question] 当我用`=`代替`==`时，我所用的编译器没有发出警告。是否有办法可以强制编译器注意这类问题？
> 下面是一些程序员使用的技巧：他们习惯性地将
> ```c
> if (i == 0) ...
> ```
> ```c
> if (0 == i) ...
> ```
> 因为不可能给 0 赋值，所以编译器会产生一条出错消息。我没有用这种技巧，因为我觉得这样会使程序看上去很不自然。而且这种技巧也只能在判定条件中的一个操作数不是左值的时候使用。
> 幸运的是，许多编译器可以检测出 `if` 条件中 `=` 运算符的可疑使用。例如，GCC 会在选中 `-Wparentheses` 选项或 `-Wall`（所有情况都警告）选项时执行这样的检查。GCC 允许程序员通过在 `if` 条件外面增加一对圆括号的方式来禁用该警告：
> ```c
> if ((i = j)) ...
> ```

> [!question] 为什么 C99 没有为布尔类型取一个更好的名字？
> `_Bool` 不算好名字，是吧？ C99 没有采用 `bool` 和 `boolean` 这些更常见的名字，这是因为现有的 C 程序中可能已经定义了这些名字，再使用可能会导致编译错误。

> [!question] 明白了。但是为什么 `_Bool` 这个名字就不会影响已有的程序呢？
> C89 标准指出，以下划线开头，后跟一个大写字母的名字是保留字，程序员不应该使用。

# 代码风格

## K&R 风格

它是 Brian W. Kernighan 和 Dennis M. Ritchie 合著的《C 程序设计语言》一书中使用的风格，也是本书中的程序所采用的风格。在此风格中，左花括号出现在行的末尾：

```c
if (line_num == MAX_LINES) {
	line_num = 0;
	page_num++;
}
```

K&R 风格通过不让左花括号单独占一行来保持程序紧凑。缺点是可能很难找到左花括号。（我认为这不是什么问题，因为内部语句的缩进可以清楚地显示出左花括号的位置。）顺便提一下，K&R 风格是 Java 中最常使用的。

## Allman 风格

它是以 Eric Allman（sendmail 和其他 UNIX 工具的作者）的姓氏命名的。每个左花括号单独占一行：

```c
if (line_num == MAX_LINES)
{
	line_num = 0;
	page_num++;
}
```

这种风格易于检查括号的匹配。

## Whitesmiths 风格

它是因 Whitesmiths C 编译器而普及起来的，其中规定花括号采用缩进格式：

```c
if (line_num == MAX_LINES)
	{
	line_num = 0;
	page_num++;
	}
```

## GNU 风格

它用于 GNU 项目所开发的软件中，其中的花括号采用缩进形式，然后再进一步缩进内层的语句：

```c
if (line_num == MAX_LINES)
	{
		line_num = 0;
		page_num++;
	}
```