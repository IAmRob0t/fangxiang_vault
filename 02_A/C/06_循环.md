---
tags:
  - c
---
# `while` 语句

## 无限循环

# `do` 语句

## 计算整数的位数

方法是把输入的整数反复除以 10，直到结果变为 0 时停止，除法的次数就是所求的位数。因为不知道到底需要多少次除法运算才能达到 0，所以很明显程序需要某种循环。但是应该用 `while` 语句还是 `do` 语句呢？`do` 语句显然更合适，因为每个整数（包括 0）都至少有一位数字。

```c
/* Calculates the number of digits in an integer */
#include <stdio.h>
int main(void)
{
	int digits = 0, n;
	printf("Enter a nonnegative integer: ");
	scanf("%d", &n);
	
	do {
		n /= 10;
		digits++;
	} while (n > 0);
	
	printf("The number has %d digit(s).\n", digits);
	return 0;
}
```

# `for` 语句

## `for` 语句的惯用法

## 在 `for` 语句中省略表达式

如果省略第二个表达式，那么它默认为真值，因此 `for` 语句不会终止（除非以某种其他形式停止）。例如，某些程序员用下列 `for` 语句建立无限循环：

```c
for(; ; )
{...}
```

## C99 中的 `for` 语句

## 逗号运算符

有些时候，我们可能喜欢编写有两个（或更多个）初始表达式的 `for` 语句，或者希望在每次循环时一次对几个变量进行自增操作。使用逗号表达式（comma expression）作为 `for` 语句中第一个或第三个表达式可以实现这些想法。

逗号表达式的格式如下所示：

```c
表达式 1, 表达式 2
```

这里的 `表达式 1` 和 `表达式 2` 是两个任意的表达式。逗号表达式的计算要通过两步来实现：

第一步，计算 `表达式 1` 并且扔掉计算出的值；第二步，计算 `表达式 2`，把这个值作为整个表达式的值。对 `表达式 1` 的计算应该始终会有副作用；如果没有，那么 `表达式 1` 就没有了存在的意义。

# 退出循环

## `break` 语句

对于退出点在循环体中间而不是循环体之前或之后的情况，`break` 语句特别有用。读入用户输入并且在遇到特殊输入值时终止的循环通常属于这种类型：

```c
for (;;) {
	printf("Enter a number (enter 0 to stop): ");
	scanf("%d", &n);
	if (n == 0)
		break;
	printf("%d cubed is %d\n", n, n * n * n); }
```

## `continue` 语句

## `goto` 语句

C99 增加了一条限制：`goto` 语句不可以用于绕过变长数组（ 8.3 节）的声明。

# 空语句

语句可以为空，也就是除了末尾处的分号以外什么符号也没有。下面是一个示例：

```c
i = 0; ; j = 1;
```

---

空语句主要有一个好处：编写空循环体的循环。正如 6.4 节中寻找素数的循环：

```c
for (d = 2; d < n; d++)
	if (n % d == 0)
		break;
```

如果把条件 `n % d == 0` 移到循环控制表达式中，那么循环体就会变为空：

```c
for (d = 2; d < n && n % d != 0; d++)
	/* empty loop body */;
```

注意上面是如何把空语句单独放置在一行的，不要写成：

```c
for (d = 2; d < n && n % d != 0; d++);
```

C 程序员习惯性地把空语句单独放置在一行。否则，有些人阅读程序时可能会搞不清 `for` 语句后边的语句是否是其循环体

把普通循环转换成带空循环体的循环不会带来很大的好处：新循环往往更简洁，但通常不会提高效率。但是在一些情况下，带空循环体的循环比其他循环更高效。例如，这些带空循环体的循环更便于读取字符（ 7.3 节）数据。

# 问与答

> [!question] 6.3 节提到，大多数 `for` 循环可以利用标准模式转换成 `while` 循环。能给出一个反例吗？
> 当 `for` 循环体中含有 `continue` 语句时，6.3 节给出的 `while` 模式将不再有效。思考下面这个来自 6.4 节的示例：
> ```c
> n = 0;
> sum = 0;
> while (n < 10) {
> 	scanf("%d", &i);
> 	if (i == 0)
> 		continue;
> 	sum += i;
> 	n++;
> }
> ```
> 乍看之下，好像可以把 `while` 循环转换成 `for` 循环：
> ```c
> sum = 0;
> for (n = 0; n < 10; n++) {
> 	scanf("%d", &i);
> 	if (i == 0) continue;
> 	sum += i;
> }
> ```
> 但是，这个循环并不等价于原始循环。当 `i` 等于 0 时，原始循环并没有对 `n` 进行自增操作，新循环却做了。

> [!question] 哪个无限循环格式更可取，`while (1)` 还是 `for (;;)`？
> C 程序员传统上喜欢 `for (;;)` 的高效性。这是因为早期的编译器经常强制程序在每次执行 `while` 循环体时测试条件 1。但是，对于现代编译器来说，在性能上两种无限循环应该没有差别。

> [!question] 听说程序员应该永不使用 `continue` 语句。这种说法对吗？
> `continue` 语句的确很少使用。尽管如此，`continue` 语句有时还是非常方便的。假设我们编写的循环要读入一些输入数据并测试其有效性，如果有效则以某种方法进行处理。如果有许多有效性测试，或者如果它们都很复杂，那么 `continue` 语句就非常有用了。循环将类似于下面这样：
> ```c
> for(; ;) {
> 	读入数据;
> 	if（数据的第一条测试失败）
> 		continue;
> 	if（数据的第二条测试失败）
> 		continue;
> 	.
> 	.
> 	.
> 	if（数据的最后一条测试失败）
> 		continue;
> 	处理数据;
> }
> ```

> [!question] 除了把空语句单独放置在一行以外，是否还有其他方法可以凸显出空循环体？
> 一些程序员使用虚设的 `continue` 语句：
> ```c
> for (d = 2; d < n && n % d != 0; d++)
> 	continue;
> ```
> 还有一些人使用空的复合语句：
> ```c
> for (d = 2; d < n && n % d != 0; d++)
> 	{}
> ```

# 编程题

编写程序显示单月的日历。用户指定这个月的天数和该月起始日是星期几：

```c
Enter number of days in month: 31
Enter starting day of the week (1=Sun, 7=Sat): 3
       1  2  3  4  5
 6  7  8  9 10 11 12
13 14 15 16 17 18 19
20 21 22 23 24 25 26
27 28 29 30 31
```

提示：此程序不像看上去那么难。最重要的部分是一个使用变量 i 从 1 计数到 n 的 `for` 语句（这里 n 是此月的天数），`for` 语句中需要显示 i 的每个值。在循环中，用 if 语句判定 i 是否是一个星期的最后一天，如果是，就显示一个换行符。

```c
#include <stdio.h>

int main(void)
{
  int i, n, start_day;

  printf("Enter number of days in month: ");
  scanf("%d", &n);
  printf("Enter starting day of the week (1=Sun, 7=Sat): ");
  scanf("%d", &start_day);

  /* print any leading "blank dates" */
  for (i = 1; i < start_day; i++)
    printf("   ");

  /* now print the calendar */
  for (i = 1; i <= n; i++) {
    printf("%3d", i);
    if ((start_day + i - 1) % 7 == 0)
      printf("\n");
  }

  return 0;
}
```

---