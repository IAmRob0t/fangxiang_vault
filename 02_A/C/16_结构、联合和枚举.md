---
tags:
  - c
---
# 结构变量

结构体是一种由一序列的成员组成的类型，成员的存储以**顺序分配**于内存中。

结构体可以描述一个 "对象"

## 结构变量的声明

## 结构变量的初始化

## 指定初始化（C99）

## 对结构的操作

---

## 结构体的指针

如下定义一个结构体变量、结构体指针：

```c
struct person
{
	char name[10];
	int age;
	int sex;
};

struct person zhangsan;
struct person *p;
p = &zhangsan;
```

![[HAL快速入门与项目实战.pdf#page=45&rect=109,88,358,251&color=note|📖|631]]

使用以下代码访问结构体 zhangsan，是一样的效果：

```c
 zhangsan.Age = 100;
 p->age = 100;
```

p 的值是 `addr 1`，age 在“struct person”里的偏移地址是 12（注意，不是 10，向 4 取整），所以“p->age”访问的是“addr 1+12”，就是 `zhangsan` 结构体里的 age 成员。

> [!NOTE] 偏移地址
> 指的是结构体成员相对于结构体起始地址的偏移量。

---

如果让结构体指针，直接指向 GPIO 模块呢？是否可以使用结构体指针访问多个寄存器？ 可以的，代码如下：

```c
typedef struct
{
	uint32_t CRL;
	uint32_t CRH;
	uint32_t IDR;
	uint32_t ODR;
	uint32_t BSRR;
	uint32_t BRR;
	uint32_t LCKR;
} GPIO_REGS;

GPIO_REGS *gpioa = (GPIO_REGS *)0x40011000;
gpioa->BSRR = (1<<13);
```

![[HAL快速入门与项目实战.pdf#page=46&rect=105,226,450,416&color=note|📖]]

- 如何验证？
	- ![[STM32F103xx参考手册(英文原版).pdf#page=171&rect=61,631,431,690|STM32F103xx参考手册(英文原版), p.171]]
	- ![[STM32F103xx参考手册(英文原版).pdf#page=172&rect=64,696,438,754|STM32F103xx参考手册(英文原版), p.172]]
	- ......
	- ![[STM32F103xx参考手册(英文原版).pdf#page=173&rect=63,468,406,525|STM32F103xx参考手册(英文原版), p.173]]

`gpioa` 的值是 `0x4001 1000`，BSRR 在“GPIO_REGS”里的偏移地址是 0 x 10，所以“gpioa->BSRR”访问的是“0 x 40011000+0 x 10”，就是 GPIOA_BSRR 寄存器的地址。

# 结构类型

## 结构标记的声明

## 结构类型的定义

## 结构作为参数和返回值

## 复合字面量（C99）

# 嵌套的数组和结构

## 嵌套的结构

## 结构数组

## 结构数组的初始化

# 联合

联合体不同于结构体成员的存储以顺序分配于内存中，它是由一个序列的成员组成的类型，成员存储在内存中**重叠**

## 用联合来节省空间

## 用联合来构造混合的数据结构

## 为联合添加“标记字段”

# 枚举

## 枚举标记和类型名

## 枚举作为整数

## 用枚举声明“标记字段”

