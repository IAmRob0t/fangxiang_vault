---
tags:
  - 寄存器
  - CPU
  - arm
  - 初学者
---



刚接触 ARM 架构时，“寄存器”是一个频繁出现但又有些抽象的概念。这篇笔记将用简单的比喻，帮助你快速理解 ARM 处理器中最重要的核心寄存器。

## 1. 寄存器是什么？一个简单的比喻

想象一下，CPU 是一个正在工作的木匠，而内存 (RAM) 是他存放所有工具和木材的大仓库。

- **内存 (RAM)**: 就像那个**大仓库**，容量很大，但离得远，每次去拿东西（读/写数据）都需要花一些时间。
- **寄存器 (Register)**: 就像木匠手边的**工作台**，容量很小，但拿取东西（数据）几乎不花时间。

木匠（CPU）在干活时，不会频繁地跑去仓库，而是会把接下来要用的几件工具和几块木料（数据）先从仓库拿到工作台上。所有的切割、打磨、组装（运算）都在这个工作台上完成，完工后再把成品放回仓库。

> **一句话总结**：寄存器是 CPU 内部的、数量极少但速度飞快的“临时存储区”。CPU 对数据的所有“处理”都在寄存器上进行，而不是直接在内存里。

![RISC架构下CPU与内存的交互](attachments/ARM寄存器入门：CPU的工作台/RISC架构下CPU与内存的交互.png)

---

## 2. ARM 的核心寄存器组

在 ARM 架构中（无论是 Cortex-M 还是 Cortex-A 系列），我们首先需要关心的是 **16 个核心的通用寄存器**，它们的编号是 `R0` 到 `R15`。

为了方便理解，我们可以把它们分成三类：

![ARM通用寄存器组R0-R15](attachments/ARM寄存器入门：CPU的工作台/ARM通用寄存器组R0-R15.png)

### 第一类：通用寄存器 (R0 - R12)

- **作用**：这是 CPU 的“主力工具箱”或“草稿纸”。
- **特点**：它们是真正“通用”的，你可以用它们来存放任何需要临时存储的数据，比如计算的中间值、从内存读来的值等等。在编写汇编代码时，你可以自由地使用它们。

### 第二类：有特殊职责的“专职”寄存器

这三个寄存器虽然也能存数据，但它们各自有非常重要的“专职工作”，强烈建议不要将它们当成普通寄存器随意使用。

- **R13 (SP - 栈指针)**
    - **比喻**：就像一个**书签**，专门用来指向内存中一个叫做“栈”的特殊区域的顶部。
    - **职责**：栈是用来临时存放数据的，尤其在函数调用时保存局部变量、函数参数等。`SP` 的工作就是时刻追踪栈顶在哪里，确保数据能被正确地“压入”（Push）和“弹出”（Pop）。

- **R14 (LR - 链接寄存器)**
    - **比喻**：就像一张**“回程票”**。当你的程序跳转去执行一个函数（子程序）时，`LR` 会自动记下“该从哪里回来”的地址。
    - **职责**：当函数执行完毕后，CPU 查看 `LR` 寄存器，就知道应该跳回到哪里继续执行主程序。

- **R15 (PC - 程序计数器)**
    - **比喻**：就像一个**“待办事项清单”**或菜谱中指向下一步的那个手指。
    - **职责**：`PC` 永远指向**下一条将要被执行的指令**的地址。CPU 每执行完一条指令，`PC` 就会自动增加，指向再下一条指令。我们常说的“程序跳转”，其本质就是直接修改 `PC` 寄存器的值，让它指向一个新的地址。

### 第三类：程序状态寄存器 (CPSR)

- **作用**：这是 CPU 的**“状态面板”**或**“记分牌”**。它不存普通数据，而是用来记录上一次运算结果的“状态”。
- **核心标志位 (Flags)**：CPSR 中最重要的就是几个条件标志位，比如：
    - **N (Negative)**: 上一次的运算结果是**负数**吗？
    - **Z (Zero)**: 上一次的运算结果是**零**吗？
    - **C (Carry)**: 上一次的运算**有没有产生进位**？（例如，两个很大的无符号数相加，结果超出了寄存器能表示的范围）
    - **V (Overflow)**: 上一次的运算**有没有产生溢出**？（特指有符号数的溢出）
- **意义**：`CMP` (比较) 或 `TST` (测试) 等指令就是专门用来改变这些标志位的。后续的条件执行或条件跳转指令（如 `BEQ` - Branch if Equal，如果结果为零则跳转）会“查看”这些标志位，然后决定程序接下来该怎么走。

---

## 3. 总结

| 寄存器 | 别名 | 主要功能 | 通俗比喻 |
| :--- | :--- | :--- | :--- |
| **R0-R12** | - | 通用数据存储 | CPU 的主力工具箱 / 草稿纸 |
| **R13** | SP | 栈指针，指向栈顶 | 内存中的书签 |
| **R14** | LR | 链接寄存器，保存函数返回地址 | 回程票 |
| **R15** | PC | 程序计数器，指向下一条指令 | 待办事项清单 |
| **CPSR** | - | 当前程序状态寄存器 | 状态面板 / 记分牌 |

理解了这三类寄存器的核心作用，你就掌握了阅读和编写 ARM 汇编代码的基础。
