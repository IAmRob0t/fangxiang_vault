---
tags:
  - hal
---
# 设计思路

## 怎么显示一个字符？

![[21_show_text.png|519]]

## 编码集

规定了 “哪个字/符号 对应 哪个数字代号”（比如 “A”=65，“中”=20013）

### 编码格式

规定了 “怎么把那个数字代号 变成 电脑能存的 0 和 1”（比如 65 存成 `01000001`）。

| Unicode数值范围(16进制)   | UTF-8编码方式(二进制)                      |
| ------------------- | ----------------------------------- |
| 0000 0000-0000 007F | 0xxxxxxx                            |
| 0000 0080-0000 07FF | 110xxxxx 10xxxxxx                   |
| 0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx          |
| 0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

- `"ABC中"`
	* UTF-16LE：`6500 6600 6700 2D4E`
		* 浪费空间
		* 一个错误导致后面全错
	* UTF-8

## 在LCD上绘制

![[22_steps_to_show_font.png]]

# 单元测试

## 编写单元测试代码

这涉及 3 个系统：
* 字体系统
	* 添加字库
	* 选择默认字库
	* 初始化化默认字库
* 显示设备
	* 添加显示设备
	* 获取 OLED 设备
	* 初始化
* 文字系统
	* 调用 `ShowTextInDisplayDevice`

代码在 `text_test.c` 中，主要代码如下：

```c
/**********************************************************************
 * 函数名称： text_test
 * 功能描述： 文本系统单元测试函数
 * 输入参数： 无
 * 输出参数： 无
 * 返 回 值： 无
 * 修改日期       版本号     修改人	      修改内容
 * -----------------------------------------------
 * 2021/10/13	     V1.0	  韦东山	      创建
 ***********************************************************************/
void text_test(void)
{
	char *str = "www.100ask.net";
	PDisplayDevice ptDevice;
	char *name = "OLED";

	/* 添加字库 */
	AddFontLibs();

	/* 选择默认字库 */
	SetDefaultFontLib("ascii");

	/* 初始化默认字库 */
	InitDefaultFontLib();

	/* 添加显示设备 */
	AddDisplayDevices();

	/* 获得指定的显示设备 */
	ptDevice = GetDisplayDevice(name);

	if (!ptDevice)
	{
		printf("Can not get DisplayDevice %s\r\n", name);
		return;
	}

	/* 初始化设备 */
	ptDevice->Init(ptDevice);

	/* 清除屏幕 */
	memset(ptDevice->FBBase, 0, ptDevice->iSize);

	/* 在屏幕上显示文字 */
	ShowTextInDisplayDevice(ptDevice, 16, 16, str);
}
```

## 调试、上机

我们做了哪些修改？

可以用比较工具对比一下：`10_17_show_text_unittest_err` 和 `10_18_show_text_unittest_ok`

推荐的比较工具是"Beyond Compare"，下载地址：https://www.beyondcompare.cc/